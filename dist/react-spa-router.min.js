/*!
 * React Spa Router v0.0.7
 * (c) 2017 romagny13
 * Released under the MIT License.
 */
!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("react")):"function"==typeof define&&define.amd?define(["exports","react"],n):n(t.ReactSpaRouter=t.ReactSpaRouter||{},t.React)}(this,function(t,n){"use strict";function e(t,n){function e(){this.constructor=t}for(var r in n)n.hasOwnProperty(r)&&(t[r]=n[r]);t.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)}function r(t){return"undefined"==typeof t}function o(t){return"undefined"!=typeof t}function i(t){return"string"==typeof t}function a(t){return null!==t&&"object"==typeof t}function c(t){return"function"==typeof t}function u(t){return"boolean"==typeof t}function s(t){return!!t&&("object"==typeof t||"function"==typeof t)&&"function"==typeof t.then}function h(t){setTimeout(t)}function p(t){var n=i(t)?document.querySelector(t):t;if(n){var e=document.documentElement.getBoundingClientRect(),r=n.getBoundingClientRect(),o=r.left-e.left,a=r.top-e.top;h(function(){return window.scrollTo(o,a)})}}function f(){return window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")}function l(){var t=document.querySelector("base");return t?t.href:f()}function d(t){var n=[];for(var e in t)t.hasOwnProperty(e)&&n.push(e+"="+encodeURIComponent(t[e]));return n.length>0?"?"+n.join("&"):""}function v(t){return""!==t?"#"===t.charAt(0)?t:"#"+t:""}function m(t,n,e){var r=t;return a(n)&&(r+=d(n)),i(e)&&(r+=v(e)),r}function y(t,n,e){var r=t;return i(n)&&(r+=n),i(e)&&(r+=v(e)),r}function w(t,n){return t.replace(/:(\w+)(\([^\)]+\))?/g,function(t,e,r){if(n.hasOwnProperty(e))return n[e];throw new Error("Parameter "+e+" not found")})}function g(t,n){var e=n.replace(t,"");return""===e?"/":(e=e.replace(/^(\/#|#)/,""),"/"!==e.charAt(0)&&(e="/"+e),e)}function _(t){return t.indexOf("?")!==-1?t=t.split("?")[0]:t.indexOf("#")!==-1&&(t=t.split("#")[0]),t}function b(t,n){var e=g(t,n);return _(e)}function E(t){return"**"===t}function S(t,n){var e=E(t)?".*":t.replace(/:(\w+)(\([^\)]+\))?/g,function(t,n,e){return e?e:"([0-9]+)"}),r=new RegExp("^"+e+"$","i");return r.test(n)}function C(t,n){for(var e in t)if(t.hasOwnProperty(e)){var r=t[e];if(r.children){var i=C(r.children,n);if(o(i))return i}if(S(r.path,n))return r}}function k(t,n){var e={},r=[],o=E(t)?".*":t.replace(/:(\w+)(\([^\)]+\))?/g,function(t,n,e){return r.push(n),e?e:"([0-9]+)"}),i=new RegExp("^"+o+"$","i"),a=n.match(i);return a&&(a.shift(),[].slice.call(a).forEach(function(t,n){var o=r[n];e[o]=t})),e}function T(t){var n={};return o(t)&&t.split("&").forEach(function(t){var e=t.split("=");n[e[0]]=decodeURIComponent(e[1])}),n}function N(t){if(t.indexOf("?")!==-1){var n=t.split("?")[1];return n=n.replace(/#[^\/](.)+$/,"")}}function A(t){var n=t.match(/#[^\/](.)+$/);if(n)return n[0]}function P(t){return t.name||t.toString().match(/^function\s*([^\s(]+)/)[1]}function q(t,n,e){function r(c){n(c,function(n){n===!1||i(n)?e(n):(o++,o<a?r(t[o]):e(!0))})}var o=0,a=t.length;a>0?r(t[o]):e(!0)}function R(t,n,e){var r=[];return o(n.matched)&&n.matched[t]&&n.matched[t].forEach(function(n){var o=e.getInstance(n);if(!c(o[t]))throw new Error("Invalid hook type");r.push(o[t])}),r}function O(t){return t.replace(/\/$/,"")}function x(t){return"/"!==t.charAt(0)&&"**"!==t?"/"+t:t}function D(t,n){return""!==n&&"/"!==n?x(t)+x(n):x(t)}function I(t){function n(t){c(t.action)?r.push(t.action):Q(t.actions)&&t.actions.forEach(function(t){r.push(t)})}var e=t.parents,r=[];return e.forEach(function(t){n(t)}),n(t),r}function L(t){return function(n,e,r){try{var o=t(n);s(o)?o.then(e,r):e(o)}catch(t){r(t)}}}function H(t){return/^(hash|history)$/.test(t)}function U(t,n){ct[t]=n}function j(t){t.forEach(function(t){if(r(t.path))throw new Error("Path required");var n=t.name||t.path;if(ut.hasOwnProperty(n))throw new Error("RouteConfig "+n+" already registered");ut[n]=new ot(t)})}function $(t,n,e,r){function o(){s++,s<u?i(t[s]):r&&r()}function i(t){t({route:n,router:e,result:a,error:c},function(t){a=t,c=void 0,o()},function(t){a=void 0,c=t,o()})}var a,c,u=t.length,s=0;u>0?i(t[0]):r&&r()}function B(t,n,e,r){if(r)return r.test(t);if(e)return t===n;var o=_(n);return t.indexOf(o)!==-1}function M(t,n,e){return t&&e?n&&""!==n?n+" "+e:e:n}function F(t){if(i(t))return t;if(a(t))if(t.name){var n=ut[t.name];if(n){var e=w(n.path,t.params);return m(e,t.query,t.fragment)}}else if(t.path)return m(t.path,t.query,t.fragment);throw new Error("Cannot resolve link 'to'")}function V(t){return g(t,window.location.href)}function W(t,n){i(n)||(n="default"),at.publish(n,t)}var z,G,J="undefined"!=typeof window,K=J&&function(){var t=window.navigator.userAgent;return(t.indexOf("Android 2.")===-1&&t.indexOf("Android 4.0")===-1||t.indexOf("Mobile Safari")===-1||t.indexOf("Chrome")!==-1||t.indexOf("Windows Phone")!==-1)&&(window.history&&"pushState"in window.history)}(),Q=Array.isArray,X=function(){function t(t){this.url=t.url,this.path=t.path,this.params=t.params,this.queryString=t.queryString,this.query=t.query,this.fragment=t.fragment,this.matched=t.matched}return t}(),Y=function(){function t(){}return t.prototype.resolve=function(t,n,e){var r,o,i,a,c=C(t,n);return c&&(r=k(c.path,n),o=N(e),i=T(o),a=A(e)),new X({url:e,path:n,params:r,queryString:o,query:i,fragment:a,matched:c})},t}(),Z=function(){function t(){this.cache={}}return t.prototype.clear=function(){this.cache={}},t.prototype.getNewInstance=function(t){if(c(t)){var n=P(t),e=new t;return this.cache[n]=e,e}throw TypeError("Invalid type. Require a function / class")},t.prototype.getInstance=function(t){if(c(t)){var n=P(t);return this.cache.hasOwnProperty(n)?this.cache[n]:this.getNewInstance(t)}throw TypeError("Invalid type. Require a function / class")},t}(),tt=function(){function t(){this._activator=new Z}return t.prototype.checkCanDeactivate=function(t,n,e,r){var o=R("canDeactivate",t,this._activator);o.length>0?q(o,function(t,r){t(e,n,r)},r):r(!0)},t.prototype.checkCanActivate=function(t,n){var e=R("canActivate",t,this._activator);e.length>0?q(e,function(n,e){n(t,e)},n):n(!0)},t.prototype.approve=function(t,n,e,r){var o=this;this.checkCanDeactivate(t,n,e,function(t){t?o.checkCanActivate(n,r):r(!1)})},t}(),nt=function(){function t(){this._onSuccessSubscribers=[],this._onErrorSubscribers=[],this._routeResolver=new Y,this._guard=new tt,this.base=l(),this.current=new X({path:"/",url:this.base})}return t.prototype._onSuccess=function(t){this._onSuccessSubscribers.forEach(function(n){n(t)})},t.prototype._onError=function(t){this._onErrorSubscribers.forEach(function(n){n(t)})},t.prototype.redirectTo=function(t,n){if(!i(t))throw new TypeError("Invalid redirect url");n?this.replace(t):this.go(t)},t.prototype.check=function(t,n,e,a,c){var u=this,s=this._routeResolver.resolve(ut,n,t);o(s.matched)&&s.matched.redirectTo?this.redirectTo(s.matched.redirectTo,e):r(s.matched)?this._guard.checkCanDeactivate(this.current,s,ct,function(t){i(t)?u.redirectTo(t):c(t===!1?{type:"aborted",route:s}:{type:"notfound",route:s})}):this._guard.approve(this.current,s,ct,function(t){i(t)?u.redirectTo(t):t===!1?c({type:"aborted",route:s}):a(s)})},t.prototype.go=function(t){var n=this.getUrl(this.base,t);this.onDemand(n)},t.prototype.replace=function(t){var n=this.getUrl(this.base,t);this.onDemand(n,!0)},t.prototype.back=function(){window.history.go(-1)},t.prototype.forward=function(){window.history.go(1)},t.prototype.subscribe=function(t,n){return this._onSuccessSubscribers.push(t),c(n)&&this._onErrorSubscribers.push(n),this},t}(),et=function(t){function n(){return t.call(this)||this}return e(n,t),n.prototype.onLoad=function(t){var n=window.location.href,e=b(this.base,n);t({url:n,path:e})},n.prototype.onChange=function(t){window.onpopstate=function(n){n.state&&t(n.state)}},n.prototype.checkChanged=function(t){var n=this;this.check(t.url,t.path,!0,function(t){n.current=t,n._onSuccess(t)},function(t){window.history.pushState(n.getState(),null,n.current.url),n._onError&&n._onError(t)})},n.prototype.onDemand=function(t,n){var e=this,r=b(this.base,t);this.check(t,r,n,function(r){e.current=r,n?window.history.replaceState(e.getState(),null,t):window.history.pushState(e.getState(),null,t),e._onSuccess(r)},function(t){e._onError(t)})},n.prototype.run=function(){var t=this;this.onLoad(function(n){t.check(n.url,n.path,!0,function(n){t.current=n,window.history.replaceState(t.getState(),null,t.current.url),t._onSuccess(n)},function(n){t._onError(n)})}),this.onChange(function(n){t.checkChanged(n)})},n.prototype.getState=function(){return{url:this.current.url,path:this.current.path,name:this.current.name}},n.prototype.getUrl=function(t,n){return n.indexOf(t)!==-1?n:O(t)+n},n}(nt),rt=function(t){function n(){return t.call(this)||this}return e(n,t),n.prototype.onLoad=function(t){var n=window.location.href,e=b(this.base,n);t({url:n,path:e})},n.prototype.onChange=function(t){var n=this;window.onhashchange=function(){var e=window.location.href,r=b(n.base,e);t({url:e,path:r})}},n.prototype.checkChanged=function(t){var n=this;this.check(t.url,t.path,!0,function(t){n.current=t,n._onSuccess(t)},function(t){window.location.hash=y(n.current.path,n.current.queryString,n.current.fragment),n._onError&&n._onError(t)})},n.prototype.onDemand=function(t,n){var e=this,r=b(this.base,t);this.check(t,r,n,function(r){e._isChecked=!0,e.current=r,n?window.location.replace(t):window.location.hash=y(r.path,r.queryString,r.fragment),e._onSuccess(r)},function(t){e._onError&&e._onError(t)})},n.prototype.run=function(){var t=this;this.onLoad(function(n){t.checkChanged(n)}),this.onChange(function(n){t._isChecked?t._isChecked=!1:t.checkChanged(n)})},n.prototype.getUrl=function(t,n){return n.indexOf(t)!==-1?n:t+"#"+n},n}(nt),ot=function(){function t(n){var e=this;if(r(n))throw new Error("Config required");if(r(n.path))throw new Error("Path required");this.path=x(n.path),this.name=n.name||n.path,n.action?this.action=L(n.action):n.actions&&(this.actions=[],n.actions.forEach(function(t){e.actions.push(L(t))})),this.canActivate=n.canActivate,this.canDeactivate=n.canDeactivate,this.redirectTo=n.redirectTo,this.data=n.data,this.parent=n.parent,this.parents=n.parents||[],o(n.children)&&(this.children={},n.children.forEach(function(n){n.path=D(e.path,n.path),r(n.name)&&(n.name=n.path),n.parent=e,n.parents=e.parents.concat(e),e.children[n.name]=new t(n)}))}return Object.defineProperty(t.prototype,"root",{get:function(){return this.parents[0]},enumerable:!0,configurable:!0}),t}(),it=function(){function t(){this._subscribers={},this._pending={}}return t.prototype.clearPending=function(){this._pending={}},t.prototype.subscribe=function(t,n){var e=this;Q(this._subscribers[t])||(this._subscribers[t]=[]),this._subscribers[t].push(n),this._pending.hasOwnProperty(t)&&(this._subscribers[t].forEach(function(n){n(e._pending[t])}),delete this._pending[t])},t.prototype.publish=function(t,n){this._subscribers[t]?this._subscribers[t].forEach(function(t){t(n)}):this._pending[t]=n},t}(),at=new it,ct={},ut={},st=function(){function t(t){if(r(t))throw new Error("Config required");if(!Q(t.routes))throw new Error("Routes required");if(r(t.mode)&&(t.mode="hash"),!H(t.mode))throw new Error("Invalid mode (hash or history)");"history"!==t.mode||K||(t.mode="hash",console.warn("Html5 history not supported: switch to hash mode.")),this._mode=t.mode,G="hash"===this._mode?new rt:new et,this._scroll=!u(t.scroll)||t.scroll,j(t.routes)}return t.prototype.beforeEach=function(t){return this._beforeEachHook=t,this},t.prototype.afterEach=function(t){return this._afterEachHook=t,this},t.prototype._doBeforeEach=function(t){c(this._beforeEachHook)?this._beforeEachHook(t):t()},t.prototype.run=function(t,n){var e=this;return G.subscribe(function(n){at.clearPending(),z=n,c(t)&&t(n);var r=n.matched;e._doBeforeEach(function(){var t=I(r);$(t,n,e,function(){e._afterEachHook&&e._afterEachHook(n),h(function(){n.fragment&&e._scroll&&p(n.fragment)})})})},function(t){c(n)&&n(t)}).run(),this},t.prototype.navigateToUrl=function(t){if(!i(t))throw new TypeError("String url required");G.go(t)},t.prototype.navigateTo=function(t,n,e,o){var i=ut[t];if(r(i))throw new Error("No route found for route name :"+t);var a=w(i.path,n),c=m(a,e,o);this.navigateToUrl(c)},t.prototype.replaceUrl=function(t){if(!i(t))throw new TypeError("String url required");G.replace(t)},t.prototype.replace=function(t,n,e,o){var i=ut[t];if(r(i))throw new Error("No route found for route name : "+t);var a=w(i.path,n),c=m(a,e,o);this.replaceUrl(c)},t.prototype.goBack=function(){G.back()},t.prototype.goForward=function(){G.forward()},t}(),ht=function(t){function r(n){var e=t.call(this,n)||this;e._base=l(),e._fullLinkPathString=F(e.props.to),e._linkHref=G&&G instanceof rt?"#"+e._fullLinkPathString:e._fullLinkPathString;var r=V(e._base),o=!!e.props.activeClassName&&B(r,e._fullLinkPathString,e.props.exact,e.props.activePattern);return e.state={isActive:o},e.onClick=e.onClick.bind(e),e}return e(r,t),r.prototype.componentDidMount=function(){var t=this;G.subscribe(function(n){if(t.props.activeClassName){var e=V(t._base),r=B(e,t._fullLinkPathString,t.props.exact,t.props.activePattern);t.setState({isActive:r})}})},r.prototype.onClick=function(t){t.preventDefault(),G.go(this._fullLinkPathString)},r.prototype.render=function(){var t=M(this.state.isActive,this.props.className,this.props.activeClassName);if(this.props.tag){var e={id:this.props.id,href:this._linkHref,onClick:this.onClick,className:this.props.className,style:this.props.style};return n.createElement(this.props.tag,{className:t},n.createElement("a",e,this.props.children))}var e={id:this.props.id,href:this._linkHref,onClick:this.onClick,className:t,style:this.props.style};return n.createElement("a",e,this.props.children)},r}(n.Component);ht.defaultProps={exact:!0};var pt=function(t){function r(n){var e=t.call(this,n)||this;return e.state={previous:null,current:null},e._firstTime=!0,e}return e(r,t),r.prototype._preventAnimation=function(){this._isAnimating&&(clearTimeout(this._leaveTimer),clearTimeout(this._enterTimer),this.setState({previous:null,previousClassName:null,current:this._component,currentClassName:"router-page current"}),this._isAnimating=!1)},r.prototype.componentDidMount=function(){var t=this;at.subscribe(this.props.name,function(n){function e(){s++,2===s&&(r._isAnimating=!1)}var r=t,o=t.props.leave,i=t.props.leaveTimeout,a=t.props.enter,c=t.props.enterTimeout,u=t.props.simultaneous,s=0;t._firstTime||!a&&!o?(t.setState({current:n,currentClassName:"router-page current"}),t._firstTime=!1):u?(t._preventAnimation(),h(function(){t._component=n,t._isAnimating=!0;var r=t.state.current;t.setState({previous:r,previousClassName:"router-page "+o+" current",current:n,currentClassName:"router-page "+a}),t._leaveTimer=setTimeout(function(){t.setState({previous:null}),e()},i),t._enterTimer=setTimeout(function(){t.setState({currentClassName:"router-page current"}),e()},c)})):(t._preventAnimation(),h(function(){t._component=n,t._isAnimating=!0,t.setState({currentClassName:"router-page "+o+" current"}),t._leaveTimer=setTimeout(function(){t.setState({current:n,currentClassName:"router-page "+a}),t._enterTimer=setTimeout(function(){t.setState({currentClassName:"router-page current"}),t._isAnimating=!1},c)},i)}))})},r.prototype.render=function(){return n.createElement("div",{id:this.props.id,className:this.props.className,style:this.props.style},this.state.current?n.createElement("div",{className:this.state.currentClassName,style:{position:"relative"}},this.state.current):null,this.state.previous?n.createElement("div",{className:this.state.previousClassName},this.state.previous):null)},r}(n.Component);pt.defaultProps={name:"default"},t.Link=ht,t.RouterView=pt,t.viewRender=W,t.Router=st,t.setActiveComponent=U,t.Route=X,t.RouteConfig=ot,Object.defineProperty(t,"__esModule",{value:!0})});