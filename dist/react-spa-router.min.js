/*!
 * React Spa Router v0.0.5
 * (c) 2017 romagny13
 * Released under the MIT License.
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("react")):"function"==typeof define&&define.amd?define(["exports","react"],e):e(t.ReactSpaRouter=t.ReactSpaRouter||{},t.React)}(this,function(t,e){"use strict";function n(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function r(t){return"undefined"==typeof t}function o(t){return"undefined"!=typeof t}function i(t){return"string"==typeof t}function a(t){return null!==t&&"object"==typeof t}function c(t){return"function"==typeof t}function u(t){return"boolean"==typeof t}function s(t){return!!t&&("object"==typeof t||"function"==typeof t)&&"function"==typeof t.then}function h(t){setTimeout(t)}function f(t){var e=i(t)?document.querySelector(t):t;if(e){var n=document.documentElement.getBoundingClientRect(),r=e.getBoundingClientRect(),o=r.left-n.left,a=r.top-n.top;h(function(){return window.scrollTo(o,a)})}}function p(){return window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")}function l(){var t=document.querySelector("base");return t?t.href:p()}function d(t){var e=[];for(var n in t)t.hasOwnProperty(n)&&e.push(n+"="+encodeURIComponent(t[n]));return e.length>0?"?"+e.join("&"):""}function v(t){return""!==t?"#"===t.charAt(0)?t:"#"+t:""}function m(t,e,n){var r=t;return a(e)&&(r+=d(e)),i(n)&&(r+=v(n)),r}function y(t,e){return t.replace(/:(\w+)(\([^\)]+\))?/g,function(t,n,r){if(e.hasOwnProperty(n))return e[n];throw new Error("Parameter "+n+" not found")})}function g(t,e){return e.replace(t,"")}function w(t){return t.indexOf("?")!==-1?t=t.split("?")[0]:t.indexOf("#")!==-1&&(t=t.split("#")[0]),t}function _(t){return"**"===t}function b(t,e){var n=_(t)?".*":t.replace(/:(\w+)(\([^\)]+\))?/g,function(t,e,n){return n?n:"([0-9]+)"}),r=new RegExp("^"+n+"$","i");return r.test(e)}function E(t,e){for(var n in t)if(t.hasOwnProperty(n)){var r=t[n];if(r.children){var i=E(r.children,e);if(o(i))return i}if(b(r.path,e))return r}}function S(t,e){var n={},r=[],o=_(t)?".*":t.replace(/:(\w+)(\([^\)]+\))?/g,function(t,e,n){return r.push(e),n?n:"([0-9]+)"}),i=new RegExp("^"+o+"$","i"),a=e.match(i);return a&&(a.shift(),[].slice.call(a).forEach(function(t,e){var o=r[e];n[o]=t})),n}function C(t){var e={};return o(t)&&t.split("&").forEach(function(t){var n=t.split("=");e[n[0]]=decodeURIComponent(n[1])}),e}function k(t){if(t.indexOf("?")!==-1){var e=t.split("?")[1];return e=e.replace(/#[^\/](.)+$/,"")}}function T(t){var e=t.match(/#[^\/](.)+$/);if(e)return e[0]}function P(t){return t.name||t.toString().match(/^function\s*([^\s(]+)/)[1]}function N(t,e,n){function r(a){e(a,function(e){e?(o++,o<i?r(t[o]):n(!0)):n(!1)})}var o=0,i=t.length;i>0?r(t[o]):n(!0)}function A(t,e,n){var r=[];return o(n.matched)&&n.matched[e]&&n.matched[e].forEach(function(n){var o=t.getInstance(n);if(!c(o[e]))throw new Error("Invalid hook type");r.push(o[e])}),r}function O(t){return t.replace(/\/$/,"")}function H(t){return"/"!==t.charAt(0)&&"**"!==t?"/"+t:t}function R(t,e){return""!==e&&"/"!==e?H(t)+H(e):H(t)}function q(t){function e(t){c(t.action)?r.push(t.action):J(t.actions)&&t.actions.forEach(function(t){r.push(t)})}var n=t.parents,r=[];return n.forEach(function(t){e(t)}),e(t),r}function x(t){return function(e,n,r){try{var o=t(e);s(o)?o.then(n,r):n(o)}catch(t){r(t)}}}function D(t){return/^(hash|history)$/.test(t)}function I(t,e){it[t]=e}function L(t){t.forEach(function(t){if(r(t.path))throw new Error("Path required");var e=t.name||t.path;if(at.hasOwnProperty(e))throw new Error("RouteConfig "+e+" already registered");at[e]=new nt(t)})}function U(t,e,n,r){function o(){s++,s<u?i(t[s]):r&&r()}function i(t){t({route:e,router:n,result:a,error:c},function(t){a=t,c=void 0,o()},function(t){a=void 0,c=t,o()})}var a,c,u=t.length,s=0;u>0?i(t[0]):r&&r()}function j(t,e,n,r){if(r)return r.test(t);if(n)return t===e;var o=w(e);return t.indexOf(o)!==-1}function $(t,e,n){return t&&n?e&&""!==e?e+" "+n:n:e}function B(t){if(i(t))return t;if(a(t))if(t.name){var e=at[t.name];if(e){var n=y(e.path,t.params);return m(n,t.query,t.fragment)}}else if(t.path)return m(t.path,t.query,t.fragment);throw new Error("Cannot resolve link 'to'")}function F(t){return g(t,window.location.href)}function M(t,e){i(e)||(e="default"),ot.publish(e,t)}var V,W,z="undefined"!=typeof window,G=z&&function(){var t=window.navigator.userAgent;return(t.indexOf("Android 2.")===-1&&t.indexOf("Android 4.0")===-1||t.indexOf("Mobile Safari")===-1||t.indexOf("Chrome")!==-1||t.indexOf("Windows Phone")!==-1)&&(window.history&&"pushState"in window.history)}(),J=Array.isArray,K=function(){function t(t){this.url=t.url,this.path=t.path,this.params=t.params,this.queryString=t.queryString,this.query=t.query,this.fragment=t.fragment,this.matched=t.matched}return t}(),Q=function(){function t(){}return t.prototype.resolve=function(t,e,n){var r,o,i,a,c=E(t,e);return c&&(r=S(c.path,e),o=k(n),i=C(o),a=T(n)),new K({url:n,path:e,params:r,queryString:o,query:i,fragment:a,matched:c})},t}(),X=function(){function t(){this.cache={}}return t.prototype.clear=function(){this.cache={}},t.prototype.getNewInstance=function(t){if(c(t)){var e=P(t),n=new t;return this.cache[e]=n,n}throw TypeError("Invalid type. Require a function / class")},t.prototype.getInstance=function(t){if(c(t)){var e=P(t);return this.cache.hasOwnProperty(e)?this.cache[e]:this.getNewInstance(t)}throw TypeError("Invalid type. Require a function / class")},t}(),Y=function(){function t(){this._activator=new X}return t.prototype.checkCanDeactivate=function(t,e,n,r){var o=A(this._activator,"canDeactivate",t);o.length>0?N(o,function(t,r){t.call(t,n,e,r)},r):r(!0)},t.prototype.checkCanActivate=function(t,e){var n=A(this._activator,"canActivate",t);n.length>0?N(n,function(e,n){e.call(e,t,n)},e):e(!0)},t.prototype.approve=function(t,e,n,r){var o=this;this.checkCanDeactivate(t,e,n,function(t){t?o.checkCanActivate(e,r):r(!1)})},t}(),Z=function(){function t(){this._onSuccessSubscribers=[],this._onErrorSubscribers=[],this._routeResolver=new Q,this._guard=new Y,this.baseHref=l(),this.current=new K({path:"/",url:this.baseHref})}return t.prototype._onSuccess=function(t){this._onSuccessSubscribers.forEach(function(e){e(t)})},t.prototype._onError=function(t){this._onErrorSubscribers.forEach(function(e){e(t)})},t.prototype.redirectTo=function(t,e){if(!i(t))throw new TypeError("Invalid redirect url");e?this.replace(t):this.go(t)},t.prototype.check=function(t,e,n,i,a){var c=this._routeResolver.resolve(at,e,t);o(c.matched)&&c.matched.redirectTo?this.redirectTo(c.matched.redirectTo,n):r(c.matched)?this._guard.checkCanDeactivate(this.current,c,it,function(t){a(t?{type:"notfound",route:c}:{type:"aborted",route:c})}):this._guard.approve(this.current,c,it,function(t){t?i(c):a({type:"aborted",route:c})})},t.prototype.go=function(t){var e=this.getUrl(this.baseHref,t);this.onDemand(e)},t.prototype.replace=function(t){var e=this.getUrl(this.baseHref,t);this.onDemand(e,!0)},t.prototype.back=function(){window.history.go(-1)},t.prototype.forward=function(){window.history.go(1)},t.prototype.subscribe=function(t,e){return this._onSuccessSubscribers.push(t),c(e)&&this._onErrorSubscribers.push(e),this},t}(),tt=function(t){function e(){return t.call(this)||this}return n(e,t),e.prototype.onLoad=function(t){var e=window.location.href,n=this.getPath(this.baseHref,e);t({url:e,path:n})},e.prototype.onChange=function(t){window.onpopstate=function(e){t(e.state)}},e.prototype.checkChanged=function(t){var e=this;this.check(t.url,t.path,!0,function(t){e.current=t,e._onSuccess(t)},function(t){window.history.pushState(e.getState(),null,e.current.url),e._onError&&e._onError(t)})},e.prototype.onDemand=function(t,e){var n=this,r=this.getPath(this.baseHref,t);this.check(t,r,e,function(r){n.current=r,e?window.history.replaceState(n.getState(),null,t):window.history.pushState(n.getState(),null,t),n._onSuccess(r)},function(t){n._onError(t)})},e.prototype.run=function(){var t=this;this.onLoad(function(e){t.check(e.url,e.path,!0,function(e){t.current=e,window.history.replaceState(t.getState(),null,t.current.url),t._onSuccess(e)},function(e){t._onError(e)})}),this.onChange(function(e){t.checkChanged(e)})},e.prototype.getState=function(){return{url:this.current.url,path:this.current.path,name:this.current.name}},e.prototype.getPath=function(t,e){if(e.indexOf(t)!==-1){var n=/\/$/.test(t)?"/":"",r=e.replace(t,n);return""===r?"/":w(r)}return w(e)},e.prototype.getUrl=function(t,e){return e.indexOf(t)!==-1?e:O(t)+e},e}(Z),et=function(t){function e(){return t.call(this)||this}return n(e,t),e.prototype.onLoad=function(t){var e=window.location.href,n=this.getPath(this.baseHref,e);t({url:e,path:n})},e.prototype.onChange=function(t){var e=this;window.onhashchange=function(){var n=window.location.href,r=e.getPath(e.baseHref,n);t({url:n,path:r})}},e.prototype.checkChanged=function(t){var e=this;this.check(t.url,t.path,!0,function(t){e.current=t,e._onSuccess(t)},function(t){window.location.hash=e.getFullHash(e.current),e._onError&&e._onError(t)})},e.prototype.onDemand=function(t,e){var n=this,r=this.getPath(this.baseHref,t);this.check(t,r,e,function(r){n._isChecked=!0,n.current=r,e?window.location.replace(t):window.location.hash=n.getFullHash(r),n._onSuccess(r)},function(t){n._onError&&n._onError(t)})},e.prototype.run=function(){var t=this;this.onLoad(function(e){t.checkChanged(e)}),this.onChange(function(e){t._isChecked?t._isChecked=!1:t.checkChanged(e)})},e.prototype.getFullHash=function(t){var e=t.path;return e+=t.queryString||"",e+=t.fragment||""},e.prototype.getPath=function(t,e){var n;return e.indexOf(t)!==-1?(n=e.replace(t,""),""===n?"/":("#"===n.charAt(0)&&(n=n.slice(1)),w(n))):w(e)},e.prototype.getUrl=function(t,e){return e.indexOf(t)!==-1?e:t+"#"+e},e}(Z),nt=function(){function t(e){var n=this;if(r(e))throw new Error("Config required");if(r(e.path))throw new Error("Path required");this.path=H(e.path),this.name=e.name||e.path,e.action?this.action=x(e.action):e.actions&&(this.actions=[],e.actions.forEach(function(t){n.actions.push(x(t))})),this.canActivate=e.canActivate,this.canDeactivate=e.canDeactivate,this.redirectTo=e.redirectTo,this.data=e.data,this.parent=e.parent,this.parents=e.parents||[],o(e.children)&&(this.children={},e.children.forEach(function(e){e.path=R(n.path,e.path),r(e.name)&&(e.name=e.path),e.parent=n,e.parents=n.parents.concat(n),n.children[e.name]=new t(e)}))}return Object.defineProperty(t.prototype,"root",{get:function(){return this.parents[0]},enumerable:!0,configurable:!0}),t}(),rt=function(){function t(){this._subscribers={},this._pending={}}return t.prototype.clearPending=function(){this._pending={}},t.prototype.subscribe=function(t,e){var n=this;J(this._subscribers[t])||(this._subscribers[t]=[]),this._subscribers[t].push(e),this._pending.hasOwnProperty(t)&&(this._subscribers[t].forEach(function(e){e(n._pending[t])}),delete this._pending[t])},t.prototype.publish=function(t,e){this._subscribers[t]?this._subscribers[t].forEach(function(t){t(e)}):this._pending[t]=e},t}(),ot=new rt,it={},at={},ct=function(){function t(t){if(r(t))throw new Error("Config required");if(!J(t.routes))throw new Error("Routes required");if(r(t.mode)&&(t.mode="hash"),!D(t.mode))throw new Error("Invalid mode (hash or history)");"history"!==t.mode||G||(t.mode="hash",console.warn("Html5 history not supported: switch to hash mode.")),this._mode=t.mode,W="hash"===this._mode?new et:new tt,this._scroll=!u(t.scroll)||t.scroll,L(t.routes)}return t.prototype.beforeEach=function(t){return this._beforeEachHook=t,this},t.prototype.afterEach=function(t){return this._afterEachHook=t,this},t.prototype._doBeforeEach=function(t){c(this._beforeEachHook)?this._beforeEachHook(t):t()},t.prototype.run=function(t,e){var n=this;return W.subscribe(function(e){ot.clearPending(),V=e,c(t)&&t(e);var r=e.matched;n._doBeforeEach(function(){var t=q(r);U(t,e,n,function(){e.fragment&&n._scroll&&f(e.fragment),n._afterEachHook&&n._afterEachHook(e)})})},function(t){c(e)&&e(t)}).run(),this},t.prototype.navigateToUrl=function(t){if(!i(t))throw new TypeError("String url required");W.go(t)},t.prototype.navigateTo=function(t,e,n,o){var i=at[t];if(r(i))throw new Error("No route found for route name :"+t);var a=y(i.path,e),c=m(a,n,o);this.navigateToUrl(c)},t.prototype.replaceUrl=function(t){if(!i(t))throw new TypeError("String url required");W.replace(t)},t.prototype.replace=function(t,e,n,o){var i=at[t];if(r(i))throw new Error("No route found for route name : "+t);var a=y(i.path,e),c=m(a,n,o);this.replaceUrl(c)},t.prototype.goBack=function(){W.back()},t.prototype.goForward=function(){W.forward()},t}(),ut=function(t){function r(e){var n=t.call(this,e)||this;n._base=l(),n._fullLinkPathString=B(n.props.to),n._linkHref=W&&W instanceof et?"#"+n._fullLinkPathString:n._fullLinkPathString;var r=F(n._base),o=!!n.props.activeClassName&&j(r,n._fullLinkPathString,n.props.exact,n.props.activePattern);return n.state={isActive:o},n.onClick=n.onClick.bind(n),n}return n(r,t),r.prototype.componentDidMount=function(){var t=this;W.subscribe(function(e){if(t.props.activeClassName){var n=F(t._base),r=j(n,t._fullLinkPathString,t.props.exact,t.props.activePattern);t.setState({isActive:r})}})},r.prototype.onClick=function(t){t.preventDefault(),W.go(this._fullLinkPathString)},r.prototype.render=function(){var t=$(this.state.isActive,this.props.className,this.props.activeClassName);if(this.props.tag){var n={id:this.props.id,href:this._linkHref,onClick:this.onClick,className:this.props.className,style:this.props.style};return e.createElement(this.props.tag,{className:t},e.createElement("a",n,this.props.children))}var n={id:this.props.id,href:this._linkHref,onClick:this.onClick,className:t,style:this.props.style};return e.createElement("a",n,this.props.children)},r}(e.Component);ut.defaultProps={exact:!0};var st=function(t){function r(e){var n=t.call(this,e)||this;return n.state={previous:null,current:null},n._firstTime=!0,n}return n(r,t),r.prototype._preventAnimation=function(){this._isAnimating&&(clearTimeout(this._leaveTimer),clearTimeout(this._enterTimer),this.setState({previous:null,previousClassName:null,current:this._component,currentClassName:"router-page current"}),this._isAnimating=!1)},r.prototype.componentDidMount=function(){var t=this;ot.subscribe(this.props.name,function(e){function n(){s++,2===s&&(r._isAnimating=!1)}var r=t,o=t.props.leave,i=t.props.leaveTimeout,a=t.props.enter,c=t.props.enterTimeout,u=t.props.simultaneous,s=0;t._firstTime||!a&&!o?(t.setState({current:e,currentClassName:"router-page current"}),t._firstTime=!1):u?(t._preventAnimation(),h(function(){t._component=e,t._isAnimating=!0;var r=t.state.current;t.setState({previous:r,previousClassName:"router-page "+o+" current",current:e,currentClassName:"router-page "+a}),t._leaveTimer=setTimeout(function(){t.setState({previous:null}),n()},i),t._enterTimer=setTimeout(function(){t.setState({currentClassName:"router-page current"}),n()},c)})):(t._preventAnimation(),h(function(){t._component=e,t._isAnimating=!0,t.setState({currentClassName:"router-page "+o+" current"}),t._leaveTimer=setTimeout(function(){t.setState({current:e,currentClassName:"router-page "+a}),t._enterTimer=setTimeout(function(){t.setState({currentClassName:"router-page current"}),t._isAnimating=!1},c)},i)}))})},r.prototype.render=function(){return e.createElement("div",{id:this.props.id,className:this.props.className,style:this.props.style},this.state.current?e.createElement("div",{className:this.state.currentClassName,style:{position:"relative"}},this.state.current):null,this.state.previous?e.createElement("div",{className:this.state.previousClassName},this.state.previous):null)},r}(e.Component);st.defaultProps={name:"default"},t.Link=ut,t.RouterView=st,t.viewRender=M,t.Router=ct,t.setActiveComponent=I,t.Route=K,t.RouteConfig=nt,Object.defineProperty(t,"__esModule",{value:!0})});